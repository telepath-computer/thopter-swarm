# Remap prefix from Ctrl-b to Ctrl-a
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Reduce Escape key delay so exiting copy-mode feels instant (default 500ms)
set -g escape-time 50

# Enable mouse support (scroll wheel enters copy-mode and scrolls history)
set -g mouse on

# Explicit WheelUp/Down bindings for panes. tmux 3.3a's built-in default
# doesn't auto-enter copy-mode on scroll, so we must bind it explicitly.
# If the pane's application has mouse tracking, forward the event; otherwise
# enter copy-mode (with -e to auto-exit at bottom) and forward.
bind -T root WheelUpPane if-shell -Ft= '#{mouse_any_flag}' 'send-keys -M' 'copy-mode -e; send-keys -M'
bind -T root WheelDownPane if-shell -Ft= '#{mouse_any_flag}' 'send-keys -M' 'send-keys -M'

# Override default 5-line scroll to 1 line per wheel tick for precise positioning
bind -T copy-mode WheelUpPane select-pane \; send-keys -X scroll-up
bind -T copy-mode WheelDownPane select-pane \; send-keys -X scroll-down
bind -T copy-mode-vi WheelUpPane select-pane \; send-keys -X scroll-up
bind -T copy-mode-vi WheelDownPane select-pane \; send-keys -X scroll-down

# Double-click selects word, triple-click selects line.
# Root bindings enter copy-mode first (so it works without scrolling up).
# Copy-mode bindings handle re-selecting when already in copy-mode.
# Default auto-copies-and-cancels; we just select and let drag-end handle copying.
bind -T root DoubleClick1Pane select-pane -t = \; if-shell -F '#{||:#{pane_in_mode},#{mouse_any_flag}}' 'send-keys -M' 'copy-mode ; send-keys -X select-word'
bind -T root TripleClick1Pane select-pane -t = \; if-shell -F '#{||:#{pane_in_mode},#{mouse_any_flag}}' 'send-keys -M' 'copy-mode ; send-keys -X select-line'
bind -T copy-mode DoubleClick1Pane select-pane \; send-keys -X select-word
bind -T copy-mode TripleClick1Pane select-pane \; send-keys -X select-line
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send-keys -X select-word
bind -T copy-mode-vi TripleClick1Pane select-pane \; send-keys -X select-line

# Mouse drag-end copies selection to clipboard (via OSC 52) and clears the
# selection, but stays in copy-mode at the current scroll position.
# Default copy-pipe-and-cancel exits copy mode on mouse release.
bind -T copy-mode MouseDragEnd1Pane send-keys -X copy-selection
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection

# Allow OSC 52 clipboard escape sequences to pass through to the terminal
set -g set-clipboard on
# Needed so tmux doesn't eat the escape sequences
set -g allow-passthrough on

# Tell tmux that xterm terminals support extended mouse (SGR protocol).
# SGR mouse uses text-based escape sequences that work reliably with xterm.js.
set -as terminal-features 'xterm*:mouse'
